{"ast":null,"code":"import axios from 'axios';\nimport Vue from 'vue';\nexport default {\n  data() {\n    return {\n      plate: '',\n      cardId: '',\n      parkMovements: [],\n      sortedParkMovements: [],\n      errorMessage: null,\n      popupVehicle: {} // Objeto para armazenar as informações do veículo no popup\n    };\n  },\n  mounted() {\n    this.fetchParkMovements();\n  },\n  computed: {\n    sortedParkMovements() {\n      return this.parkMovements.sort((a, b) => new Date(b.entry_date) - new Date(a.entry_date));\n    }\n  },\n  methods: {\n    async fetchParkMovements() {\n      try {\n        const response = await axios.get('http://localhost:8000/api/v1/park-movements/');\n        this.parkMovements = response.data;\n      } catch (error) {\n        console.error(error);\n        this.errorMessage = 'Erro ao buscar veículos no pátio.';\n      }\n    },\n    async registerEntry() {\n      this.errorMessage = null;\n      try {\n        const response = await axios.post('http://localhost:8000/api/v1/park-movements/', {\n          plate: this.plate,\n          card_id: this.cardId\n        });\n        this.fetchParkMovements();\n        this.plate = '';\n        this.cardId = '';\n      } catch (error) {\n        console.error(error);\n        if (error.response && error.response.data && error.response.data.error) {\n          this.errorMessage = error.response.data.error;\n        } else {\n          this.errorMessage = 'Erro ao registrar entrada.';\n        }\n      }\n    },\n    async registerExit(movementId) {\n      this.errorMessage = null;\n      try {\n        const response = await axios.patch(`http://localhost:8000/api/v1/park-movements/${movementId}/`, {\n          exit_date: new Date().toISOString()\n        });\n        this.fetchParkMovements();\n        this.amount = response.data.value;\n      } catch (error) {\n        console.error(error);\n        if (error.response && error.response.data && error.response.data.error) {\n          this.errorMessage = error.response.data.error;\n        } else {\n          this.errorMessage = 'Erro ao registrar saída.';\n        }\n      }\n    },\n    showExitPopup(movementId) {\n      // Encontre o movimento do veículo pelo ID\n      const movement = this.sortedParkMovements.find(m => m.id === movementId);\n      if (movement) {\n        // Preencha o objeto popupVehicle com as informações do movimento\n        this.popupVehicle = movement;\n        // Exiba o popup\n        $('#exitPopup').modal('show');\n      }\n    }\n  }\n};","map":{"version":3,"names":["axios","Vue","data","plate","cardId","parkMovements","sortedParkMovements","errorMessage","popupVehicle","mounted","fetchParkMovements","computed","sort","a","b","Date","entry_date","methods","response","get","error","console","registerEntry","post","card_id","registerExit","movementId","patch","exit_date","toISOString","amount","value","showExitPopup","movement","find","m","id","$","modal"],"sources":["C:\\Users\\Lucas\\Desktop\\teste_cp_ex2\\frontend\\src\\components\\Operation.vue"],"sourcesContent":["<template>\r\n  <div class=\"container mt-5\">\r\n    <h1>Operação</h1>\r\n    <div class=\"row\">\r\n      <div class=\"col-md-6\">\r\n        <h2>Entrada de Veículo</h2>\r\n        <div class=\"form-group\">\r\n          <label for=\"plateInput\">Placa:</label>\r\n          <input type=\"text\" class=\"form-control\" id=\"plateInput\" v-model=\"plate\" />\r\n        </div>\r\n        <div class=\"form-group\">\r\n          <label for=\"cardIdInput\">ID do Cartão:</label>\r\n          <input type=\"text\" class=\"form-control\" id=\"cardIdInput\" v-model=\"cardId\" />\r\n        </div>\r\n        <button class=\"btn btn-primary\" @click=\"registerEntry\">Registrar Entrada</button>\r\n        <div v-if=\"errorMessage\" class=\"alert alert-danger mt-3\">{{ errorMessage }}</div>\r\n      </div>\r\n      <div class=\"col-md-6\">\r\n        <h2>Veículos no Pátio</h2>\r\n        <table class=\"table\">\r\n          <thead>\r\n            <tr>\r\n              <th>Placa</th>\r\n              <th>ID do Cartão</th>\r\n              <th>Entrada</th>\r\n              <th>Ações</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            <tr v-for=\"movement in sortedParkMovements\" :key=\"movement.id\">\r\n              <td>{{ movement.plate }}</td>\r\n              <td>{{ movement.card_id || '' }}</td>\r\n              <td>{{ new Date(movement.entry_date).toLocaleString() }}</td>\r\n              <td>\r\n                <button class=\"btn btn-danger btn-sm\" @click=\"showExitPopup(movement.id)\">Registrar Saída</button>\r\n              </td>\r\n            </tr>\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- Modal -->\r\n    <div class=\"modal fade\" id=\"exitPopup\" tabindex=\"-1\" aria-labelledby=\"exitPopupLabel\" aria-hidden=\"true\">\r\n      <div class=\"modal-dialog\">\r\n        <div class=\"modal-content\">\r\n          <div class=\"modal-header\">\r\n            <h5 class=\"modal-title\" id=\"exitPopupLabel\">Saída de Veículo</h5>\r\n            <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">\r\n              <span aria-hidden=\"true\">×</span>\r\n            </button>\r\n          </div>\r\n          <div class=\"modal-body\">\r\n            <div class=\"form-group\">\r\n              <label for=\"exitPlate\">Placa:</label>\r\n              <input type=\"text\" class=\"form-control\" id=\"exitPlate\" :value=\"popupVehicle.plate\" readonly>\r\n            </div>\r\n            <div class=\"form-group\">\r\n              <label for=\"exitCardId\">ID do Cartão:</label>\r\n              <input type=\"text\" class=\"form-control\" id=\"exitCardId\" :value=\"popupVehicle.card_id || '-' \" readonly>\r\n            </div>\r\n            <div class=\"form-group\">\r\n              <label for=\"exitEntryDate\">Data de Entrada:</label>\r\n              <input type=\"text\" class=\"form-control\" id=\"exitEntryDate\" :value=\"new Date(popupVehicle.entry_date).toLocaleString()\" readonly>\r\n            </div>\r\n            <div class=\"form-group\">\r\n              <label for=\"exitExitDate\">Data de Saída:</label>\r\n              <input type=\"text\" class=\"form-control\" id=\"exitExitDate\" :value=\"new Date(popupVehicle.exit_date).toLocaleString()\" readonly>\r\n            </div>\r\n            <div class=\"form-group\">\r\n              <label for=\"exitValue\">Valor a Cobrar:</label>\r\n              <input type=\"text\" class=\"form-control\" id=\"exitValue\" :value=\"popupVehicle.value || 'Gratuito'\" readonly>\r\n            </div>\r\n          </div>\r\n          <div class=\"modal-footer\">\r\n            <button type=\"button\" class=\"btn btn-secondary\" data-dismiss=\"modal\">Fechar</button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport axios from 'axios';\r\nimport Vue from 'vue';\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      plate: '',\r\n      cardId: '',\r\n      parkMovements: [],\r\n      sortedParkMovements: [],\r\n      errorMessage: null,\r\n      popupVehicle: {}, // Objeto para armazenar as informações do veículo no popup\r\n    };\r\n  },\r\n  mounted() {\r\n    this.fetchParkMovements();\r\n  },\r\n  computed: {\r\n    sortedParkMovements() {\r\n      return this.parkMovements.sort((a, b) => new Date(b.entry_date) - new Date(a.entry_date));\r\n    }\r\n  },\r\n  methods: {\r\n    async fetchParkMovements() {\r\n      try {\r\n        const response = await axios.get('http://localhost:8000/api/v1/park-movements/');\r\n        this.parkMovements = response.data;\r\n      } catch (error) {\r\n        console.error(error);\r\n        this.errorMessage = 'Erro ao buscar veículos no pátio.';\r\n      }\r\n    },\r\n    async registerEntry() {\r\n      this.errorMessage = null;\r\n      try {\r\n        const response = await axios.post('http://localhost:8000/api/v1/park-movements/', {\r\n          plate: this.plate,\r\n          card_id: this.cardId,\r\n        });\r\n        this.fetchParkMovements();\r\n        this.plate = '';\r\n        this.cardId = '';\r\n      } catch (error) {\r\n        console.error(error);\r\n        if (error.response && error.response.data && error.response.data.error) {\r\n          this.errorMessage = error.response.data.error;\r\n        } else {\r\n          this.errorMessage = 'Erro ao registrar entrada.';\r\n        }\r\n      }\r\n    },\r\n    async registerExit(movementId) {\r\n      this.errorMessage = null;\r\n      try {\r\n        const response = await axios.patch(`http://localhost:8000/api/v1/park-movements/${movementId}/`, {\r\n          exit_date: new Date().toISOString(),\r\n        });\r\n        this.fetchParkMovements();\r\n        this.amount = response.data.value\r\n      } catch (error) {\r\n        console.error(error);\r\n        if (error.response && error.response.data && error.response.data.error) {\r\n          this.errorMessage = error.response.data.error;\r\n        } else {\r\n          this.errorMessage = 'Erro ao registrar saída.';\r\n        }\r\n      }\r\n    },\r\n    showExitPopup(movementId) {\r\n      // Encontre o movimento do veículo pelo ID\r\n      const movement = this.sortedParkMovements.find(m => m.id === movementId);\r\n      if (movement) {\r\n        // Preencha o objeto popupVehicle com as informações do movimento\r\n        this.popupVehicle = movement;\r\n        // Exiba o popup\r\n        $('#exitPopup').modal('show');\r\n      }\r\n    },\r\n  },\r\n};\r\n</script>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}